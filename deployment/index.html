
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://fourcorners.asia/deployment/">
      
      
        <link rel="prev" href="../modules/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.1.21">
    
    
      
        <title>Deployment - Smart Digi Build</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.eebd395e.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="purple">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#deployment" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Smart Digi Build" class="md-header__button md-logo" aria-label="Smart Digi Build" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Smart Digi Build
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Deployment
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../super-admin/" class="md-tabs__link">
      Super Admin
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../customer-admin/" class="md-tabs__link">
      Customer Admin
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../facility/" class="md-tabs__link">
      Facility
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../user/" class="md-tabs__link">
      User
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../modules/" class="md-tabs__link">
      Modules
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="./" class="md-tabs__link md-tabs__link--active">
      Deployment
    </a>
  </li>

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Smart Digi Build" class="md-nav__button md-logo" aria-label="Smart Digi Build" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Smart Digi Build
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../super-admin/" class="md-nav__link">
        Super Admin
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../customer-admin/" class="md-nav__link">
        Customer Admin
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../facility/" class="md-nav__link">
        Facility
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../user/" class="md-nav__link">
        User
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../modules/" class="md-nav__link">
        Modules
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Deployment
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Deployment
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#backend" class="md-nav__link">
    Backend
  </a>
  
    <nav class="md-nav" aria-label="Backend">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#server-setup" class="md-nav__link">
    Server Setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secure-server-optional" class="md-nav__link">
    Secure server (Optional)
  </a>
  
    <nav class="md-nav" aria-label="Secure server (Optional)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-non-root-user" class="md-nav__link">
    Create a Non-Root User
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-ssh-key" class="md-nav__link">
    Setup SSH Key
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-pre-requisites" class="md-nav__link">
    Install Pre-requisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-mongodb" class="md-nav__link">
    Install MongoDB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-app" class="md-nav__link">
    Setup App
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-gunicorn" class="md-nav__link">
    Configure Gunicorn
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-supervisor" class="md-nav__link">
    Configure Supervisor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-nginx" class="md-nav__link">
    Configure Nginx
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssl-certificate-lets-encrypt" class="md-nav__link">
    SSL Certificate (Lets Encrypt)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#frontend" class="md-nav__link">
    Frontend
  </a>
  
    <nav class="md-nav" aria-label="Frontend">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-app_1" class="md-nav__link">
    Setup App
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nginx-config" class="md-nav__link">
    Nginx Config
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="deployment">Deployment</h1>
<h2 id="backend">Backend</h2>
<h3 id="server-setup">Server Setup</h3>
<ul>
<li>Ubuntu 22.04.2 LTS (Jammy Jellyfish)</li>
<li>Python 3.11.3</li>
</ul>
<h3 id="secure-server-optional">Secure server (Optional)</h3>
<ul>
<li>Make sure server has the latest software</li>
</ul>
<pre><code class="language-bash">sudo apt update &amp;&amp; sudo apt upgrade -y
</code></pre>
<ul>
<li><code>sudo apt update</code> - update the package list index on the system</li>
<li>
<p><code>sudo apt upgrade</code> - upgrade the installed packages on the system to their latest verions. <code>-y</code> flag will automatically answer yes to all questions</p>
</li>
<li>
<p>Install <code>unattended-upgrades</code> package to automatically install security updates</p>
</li>
</ul>
<pre><code class="language-bash">sudo apt install unattended-upgrades
</code></pre>
<p>Once installed, edit the <code>/etc/apt/apt.conf.d/20auto-upgrades</code> file and include the following line:</p>
<pre><code class="language-bash">APT::Periodic::Update-Package-Lists &quot;1&quot;;
APT::Periodic::Unattended-Upgrade &quot;1&quot;;
APT::Periodic::AutocleanInterval &quot;7&quot;;
</code></pre>
<ul>
<li><code>APT::Periodic::Update-Package-Lists "1";</code> - update the package list index on the system (update every day)</li>
<li><code>APT::Periodic::Unattended-Upgrade "1";</code> - upgrade the installed packages on the system to their latest verions</li>
<li><code>APT::Periodic::AutocleanInterval "7";</code> - remove old packages from the cache (remove every 7 days)</li>
</ul>
<p>Edit the <code>/etc/apt/apt.conf.d/50unattended-upgrades</code> file and include the following line to auto reboot the kernel updates (if any)</p>
<pre><code class="language-bash">Unattended-Upgrade::Automatic-Reboot &quot;true&quot;;
</code></pre>
<h4 id="create-a-non-root-user">Create a Non-Root User</h4>
<ul>
<li>Create a new user</li>
</ul>
<pre><code class="language-bash">sudo adduser &lt;username&gt;
sudo gpasswd -a &lt;username&gt; sudo
su - &lt;username&gt;
</code></pre>
<h4 id="setup-ssh-key">Setup SSH Key</h4>
<ul>
<li>Generate SSH key on local machine</li>
</ul>
<pre><code class="language-bash">ssh-keygen -t ed25519 -C &quot;username@email.com&quot;
</code></pre>
<ul>
<li>Copy the public key to the server</li>
</ul>
<pre><code class="language-bash">cat ~/.ssh/id_ed25519.pub
</code></pre>
<ul>
<li>Login to the server and create <code>.ssh</code> directory</li>
</ul>
<pre><code class="language-bash">mkdir ~/.ssh
chmod 700 ~/.ssh
</code></pre>
<ul>
<li>Once this user is created, we need to disable root login and password authentication</li>
</ul>
<pre><code class="language-bash">sudo nano /etc/ssh/sshd_config
</code></pre>
<ul>
<li>Change the following lines</li>
</ul>
<pre><code class="language-bash">PermitRootLogin no
PasswordAuthentication no
</code></pre>
<h3 id="install-pre-requisites">Install Pre-requisites</h3>
<ul>
<li>Install python3.11</li>
</ul>
<pre><code class="language-bash">sudo add-apt-repository ppa:deadsnakes/ppa
sudo apt update
sudo apt install python3.11 python3.11-dev python3.11-venv
</code></pre>
<ul>
<li>Install Supervisor and Nginx</li>
</ul>
<pre><code class="language-bash">sudo apt install supervisor nginx
</code></pre>
<ul>
<li>Enable Supervisor</li>
</ul>
<pre><code class="language-bash">sudo systemctl enable supervisor
sudo systemctl start supervisor
</code></pre>
<h3 id="install-mongodb">Install MongoDB</h3>
<ul>
<li>Install Gnupg and curl</li>
</ul>
<pre><code class="language-bash">sudo apt install gnupg curl
</code></pre>
<pre><code class="language-bash">curl -fsSL https://pgp.mongodb.com/server-7.0.asc | \
   sudo gpg -o /usr/share/keyrings/mongodb-server-7.0.gpg \
   --dearmor
</code></pre>
<ul>
<li>Create the list file <code>/etc/apt/sources.list.d/mongodb-org-7.0.list</code> for MongoDB</li>
</ul>
<pre><code class="language-bash">echo &quot;deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu jammy/mongodb-org/7.0 multiverse&quot; | sudo tee /etc/apt/sources.list.d/mongodb-org-7.0.list
</code></pre>
<ul>
<li>Reload local package database</li>
</ul>
<pre><code class="language-bash">sudo apt update
</code></pre>
<ul>
<li>Install MongoDB</li>
</ul>
<pre><code class="language-bash">sudo apt-get install -y mongodb-org
</code></pre>
<p>Optional. Although you can specify any available version of MongoDB, apt-get will upgrade the packages when a newer version becomes available. To prevent unintended upgrades, you can pin the package at the currently installed version:</p>
<pre><code class="language-bash">echo &quot;mongodb-org hold&quot; | sudo dpkg --set-selections
echo &quot;mongodb-org-database hold&quot; | sudo dpkg --set-selections
echo &quot;mongodb-org-server hold&quot; | sudo dpkg --set-selections
echo &quot;mongodb-mongosh hold&quot; | sudo dpkg --set-selections
echo &quot;mongodb-org-mongos hold&quot; | sudo dpkg --set-selections
echo &quot;mongodb-org-tools hold&quot; | sudo dpkg --set-selections
</code></pre>
<ul>
<li>Start MongoDB</li>
</ul>
<pre><code class="language-bash">sudo systemctl start mongod
</code></pre>
<ul>
<li>Verify that MongoDB has started successfully</li>
</ul>
<pre><code class="language-bash">sudo systemctl status mongod
</code></pre>
<ul>
<li>Enable MongoDB during system startup</li>
</ul>
<pre><code class="language-bash">sudo systemctl enable mongod
</code></pre>
<ul>
<li>Restart MongoDB</li>
</ul>
<pre><code class="language-bash">sudo systemctl restart mongod
</code></pre>
<ul>
<li>MongoDB Shell</li>
</ul>
<pre><code class="language-bash">    mongosh
</code></pre>
<p>Note: Refer <a href="https://www.mongodb.com/docs/manual/tutorial/install-mongodb-on-ubuntu/">MongoDB</a> for more details</p>
<h3 id="setup-app">Setup App</h3>
<ul>
<li>Create a directory for the app</li>
</ul>
<pre><code class="language-bash">mkdir -p ~/apps/smart-digi-build
</code></pre>
<ul>
<li>Clone the app</li>
</ul>
<pre><code class="language-bash">git clone &lt;git-url&gt; ~/apps/smart-digi-build
</code></pre>
<ul>
<li>Filezilla (Optional)</li>
</ul>
<p>If you are using Filezilla, you can use the below steps to copy the files to the server.</p>
<ul>
<li>Open Filezilla and connect to the server</li>
<li>Navigate to the <code>~/apps/smart-digi-build</code> directory</li>
<li>
<p>Copy the files from local machine to the server</p>
</li>
<li>
<p>Create a virtual environment</p>
</li>
</ul>
<pre><code class="language-bash">cd ~/apps/smart-digi-build
python3.11 -m venv venv
</code></pre>
<ul>
<li>Activate the virtual environment</li>
</ul>
<pre><code class="language-bash">source venv/bin/activate
</code></pre>
<ul>
<li>Install the requirements</li>
</ul>
<pre><code class="language-bash">pip install -r requirements.txt
</code></pre>
<ul>
<li>Verify the installation</li>
</ul>
<pre><code class="language-bash">Uvicorn app.main:app --reload
</code></pre>
<h3 id="configure-gunicorn">Configure Gunicorn</h3>
<ul>
<li>Install Gunicorn (make sure virtual environment is activated)</li>
</ul>
<pre><code class="language-bash">pip install gunicorn
</code></pre>
<ul>
<li>Create a Gunicorn config file</li>
</ul>
<pre><code class="language-bash">sudo nano gunicorn_start
</code></pre>
<ul>
<li>Add the following lines</li>
</ul>
<pre><code class="language-bash">#!/bin/bash

NAME=&lt;app-name&gt;
DIR=/apps/smart-digi-build/
USER=&lt;user-name&gt;
GROUP=&lt;user-group&gt;
WORKERS=3
WORKER_CLASS=uvicorn.workers.UvicornWorker
VENV=$DIR/.venv/bin/activate
BIND=unix:$DIR/run/gunicorn.sock
LOG_LEVEL=error

cd $DIR
source $VENV

exec gunicorn app.main:app \
  --name $NAME \
  --workers $WORKERS \
  --worker-class $WORKER_CLASS \
  --user=$USER \
  --group=$GROUP \
  --bind=$BIND \
  --log-level=$LOG_LEVEL \
  --log-file=-

</code></pre>
<ul>
<li>Make the file executable</li>
</ul>
<pre><code class="language-bash">chmod u+x gunicorn_start
</code></pre>
<ul>
<li>Create run folder in the project directory</li>
</ul>
<pre><code class="language-bash">mkdir run
</code></pre>
<h3 id="configure-supervisor">Configure Supervisor</h3>
<ul>
<li>Create directory called logs in the project directory</li>
</ul>
<pre><code class="language-bash">mkdir logs
</code></pre>
<ul>
<li>Create a Supervisor config file</li>
</ul>
<pre><code class="language-bash">sudo nano /etc/supervisor/conf.d/&lt;app-name&gt;.conf
</code></pre>
<ul>
<li>Add the following lines</li>
</ul>
<pre><code class="language-bash">[program:&lt;app-name&gt;]
command=/apps/smart-digi-build/gunicorn_start
user=&lt;user-name&gt;
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/apps/smart-digi-build/logs/gunicorn_supervisor.log
</code></pre>
<ul>
<li>Update Supervisor</li>
</ul>
<pre><code class="language-bash">sudo supervisorctl reread
sudo supervisorctl update
</code></pre>
<ul>
<li>Start the app</li>
</ul>
<pre><code class="language-bash">sudo supervisorctl start &lt;app-name&gt;
</code></pre>
<ul>
<li>Check the status</li>
</ul>
<pre><code class="language-bash">sudo supervisorctl status &lt;app-name&gt;
</code></pre>
<ul>
<li>Restart the app</li>
</ul>
<pre><code class="language-bash">sudo supervisorctl restart &lt;app-name&gt;
</code></pre>
<h3 id="configure-nginx">Configure Nginx</h3>
<ul>
<li>Create a Nginx config file</li>
</ul>
<pre><code class="language-bash">sudo nano /etc/nginx/sites-available/&lt;app-name&gt;
</code></pre>
<ul>
<li>Add the following lines</li>
</ul>
<pre><code>upstream app_server {
    server unix:/apps/smart-digi-build/run/gunicorn.sock fail_timeout=0;
}

server {
    listen 80;

    # add here the ip address of your server
    # or a domain pointing to that ip (like example.com or www.example.com)
    server_name XXXX;

    keepalive_timeout 5;
    client_max_body_size 4G;

    access_log /apps/smart-digi-build/logs/nginx-access.log;
    error_log /apps/smart-digi-build/logs/nginx-error.log;

    location / {
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_redirect off;

        if (!-f $request_filename) {
            proxy_pass http://app_server;
            break;
        }
    }
}
</code></pre>
<p>Depend on the port you are using, you can change the <code>listen</code> port in the above config file.</p>
<ul>
<li>Create a symbolic link</li>
</ul>
<pre><code class="language-bash">sudo ln -s /etc/nginx/sites-available/&lt;app-name&gt; /etc/nginx/sites-enabled/&lt;app-name&gt;
</code></pre>
<ul>
<li>Test the Nginx config</li>
</ul>
<pre><code class="language-bash">sudo nginx -t
</code></pre>
<ul>
<li>Restart Nginx</li>
</ul>
<pre><code class="language-bash">sudo systemctl restart nginx
</code></pre>
<h3 id="ssl-certificate-lets-encrypt">SSL Certificate (Lets Encrypt)</h3>
<ul>
<li>Install Certbot</li>
</ul>
<pre><code class="language-bash">sudo apt install certbot python3-certbot-nginx
</code></pre>
<ul>
<li>Obtain a certificate</li>
</ul>
<pre><code class="language-bash">sudo certbot --nginx -d &lt;domain-name&gt;
</code></pre>
<ul>
<li>Test automatic renewal</li>
</ul>
<pre><code class="language-bash">sudo certbot renew --dry-run
</code></pre>
<h2 id="frontend">Frontend</h2>
<h3 id="setup-app_1">Setup App</h3>
<ul>
<li>Create a directory for the app</li>
</ul>
<pre><code class="language-bash">mkdir -p ~/apps/smart-digi-build-web
</code></pre>
<ul>
<li>Clone the app</li>
</ul>
<pre><code class="language-bash">git clone &lt;git-url&gt; ~/apps/smart-digi-build-web
</code></pre>
<ul>
<li>Filezilla (Optional)</li>
</ul>
<p>If you are using Filezilla, you can use the below steps to copy the files to the server.</p>
<ul>
<li>Open Filezilla and connect to the server</li>
<li>Navigate to the <code>~/apps/smart-digi-build-web</code> directory</li>
<li>Copy the files from local machine to the server</li>
</ul>
<h3 id="nginx-config">Nginx Config</h3>
<ul>
<li>Create a Nginx config file</li>
</ul>
<pre><code class="language-bash">sudo nano /etc/nginx/sites-available/&lt;app-name&gt;
</code></pre>
<ul>
<li>Add the following lines</li>
</ul>
<pre><code>server {
    listen 80;
    server_name XXXX;

    location / {
        root /apps/smart-digi-build-web/build;
        index index.html index.htm;
        try_files $uri /index.html;
    }
}
</code></pre>
<ul>
<li>Create a symbolic link</li>
</ul>
<pre><code class="language-bash">sudo ln -s /etc/nginx/sites-available/&lt;app-name&gt; /etc/nginx/sites-enabled/&lt;app-name&gt;
</code></pre>
<ul>
<li>Test the Nginx config</li>
</ul>
<pre><code class="language-bash">sudo nginx -t
</code></pre>
<ul>
<li>Restart Nginx</li>
</ul>
<pre><code class="language-bash">sudo systemctl restart nginx
</code></pre>
<p>Depend on the port you are using, you can change the <code>listen</code> port in the above config file. </p>
<p>Note: When building front end application make sure to point the backend
url to the server url. For example, if the backend is running on port 8000 and the server url is <code>http://localhost:8000</code>, then the backend url should be <code>http://&lt;server-ip&gt;:8000</code></p>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2023 <a href="https://fourcorners.asia"  target="_blank" rel="noopener">Smart Digi Build</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>